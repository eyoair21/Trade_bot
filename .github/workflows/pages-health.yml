name: Pages Health Check

on:
  schedule:
    - cron: "0 6 * * *"  # 06:00 UTC daily
  workflow_dispatch:  # Manual trigger

jobs:
  smoke-test:
    name: Smoke Test GitHub Pages
    runs-on: ubuntu-latest

    steps:
      - name: Check Pages endpoints
        run: |
          BASE="https://eyoair21.github.io/Trade_bot"
          REQUIRED=("" "/reports/")
          FAILED=0

          echo "=== Pages Health ==="
          for ep in "${REQUIRED[@]}"; do
            url="${BASE}${ep}"
            code=$(curl -sL -o /dev/null -w "%{http_code}" "$url" || echo "ERR")
            if [ "$code" = "200" ]; then
              printf "✓ %-55s %s\n" "$url" "$code"
            else
              printf "✗ %-55s %s\n" "$url" "$code"
              FAILED=1
            fi
          done

          echo ""
          # Optional endpoints (may not exist on first runs)
          for ep in "/reports/history.json" "/reports/feed.xml" "/reports/latest/regression_report.html"; do
            url="${BASE}${ep}"
            code=$(curl -sL -o /dev/null -w "%{http_code}" "$url" || echo "ERR")
            if [ "$code" = "200" ]; then
              printf "✓ %-55s %s\n" "$url" "$code"
            else
              printf "⚠ %-55s %s\n" "$url" "$code"
            fi
          done

          if [ "$FAILED" = "1" ]; then
            echo "::error::Required endpoints failed"
            exit 1
          fi

